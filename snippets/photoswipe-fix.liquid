<script>
(function() {
  'use strict';
  
  // Early exit for desktop
  if (window.innerWidth > 768) return;
  
  let observer = null;
  let styleInjected = false;
  
  // Inject styles once
  function injectStyles() {
    if (styleInjected) return;
    
    const style = document.createElement('style');
    style.id = 'pswp-mobile-fix';
    style.textContent = `
      @media (max-width: 768px) {
        .pswp--open img {
          max-width: 100% !important;
          max-height: 80vh !important;
          object-fit: contain !important;
          display: block !important;
          margin: 0 auto !important;
        }
        .pswp--open .pswp__zoom-wrap {
          width: 100% !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
        .pswp--open .pswp__item {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
      }
    `;
    document.head.appendChild(style);
    styleInjected = true;
  }
  
  // Inject styles immediately
  injectStyles();
  
  // Single event listener for all interactions
  document.addEventListener('click', function(e) {
    if (window.innerWidth > 768) return;
    
    const target = e.target;
    
    // Handle close button
    if (target.classList?.contains('pswp__button--close')) {
      if (observer) {
        observer.disconnect();
        observer = null;
      }
      return;
    }
    
    // Handle image clicks
    if (target.closest('.product__media, [data-pswp-item], .pswp__button, img')) {
      requestAnimationFrame(function() {
        const pswp = document.querySelector('.pswp--open');
        if (!pswp || observer) return;
        
        observer = new MutationObserver(function(mutations) {
          // Observer logic if needed
        });
        
        observer.observe(pswp, {
          childList: true,
          subtree: true,
          attributes: false // Don't observe attribute changes
        });
      });
    }
  });
})();
</script>